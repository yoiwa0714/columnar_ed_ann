# v026_B_simplified パラメータ探索戦略

## 解析対象ファイル
- `columnar_ed_ann_v026_multiclass_multilayer_modular_B_simplified.py`
- `modules/ed_network.py`
- `modules/hyperparameters.py`

## パラメータリスト（学習精度への影響度順）

### 【優先度1】最重要パラメータ（上位5個）

| 順位 | パラメータ名 | 現在のデフォルト値 | 探索範囲（3段階） | 理由 |
|-----|------------|------------------|--------------------|------|
| 1 | `learning_rate` | 0.35 (2層), 0.20 (1層) | [0.1, 0.4, 0.7] | **最重要**。昨夜の結果でlr=0.7で32.75%達成。学習の収束速度と精度に直結 |
| 2 | `column_radius` | 1.0 (base) | [1.0, 2.0, 3.0] | **コラム構造の中核**。昨夜の結果でradius=2.0が最良。ニューロン間の情報共有範囲を制御 |
| 3 | `lateral_lr` | 0.08 | [0.03, 0.065, 0.1] | **側方抑制の強度**。昨夜の結果でlateral_lr=0.1が最良。クラス間競合の学習率 |
| 4 | `u1` | 0.5 | [0.3, 0.4, 0.5] | **アミン拡散係数（出力→隠れ層）**。誤差信号の伝播強度。ED法の核心パラメータ |
| 5 | `u2` | 0.8 (3層), 0.5 (2層) | [0.3, 0.4, 0.5] | **アミン拡散係数（隠れ層間）**。多層における層間誤差伝播強度 |

### 【優先度2】重要パラメータ（6-10位）

| 順位 | パラメータ名 | 現在のデフォルト値 | 探索範囲（3段階） | 理由 |
|-----|------------|------------------|--------------------|------|
| 6 | `participation_rate` | 1.0 | [0.1, 0.3, 0.5] | **コラム参加率**。スパース性の制御。1.0で重複なし、低いほど重複増加 |
| 7 | `hidden[0]` (第1層) | 256 | [300, 400, 500] | **隠れ層のニューロン数**。表現能力に直結。多いほど複雑なパターンを学習可能 |
| 8 | `hidden[1]` (第2層) | 128 | [300, 400, 500] | **第2隠れ層のニューロン数**。多層での特徴抽出の深さを制御 |
| 9 | `activation` | 'tanh' | ['tanh', 'sigmoid'] | **活性化関数**。非線形変換の種類。tanh=飽和あり、sigmoid=飽和あり（2段階のみ） |
| 10 | `epochs` | 50 (3層), 45 (2層) | [20, 30, 40] | **学習エポック数**。長いほど収束するが過学習リスクあり |

### 【優先度3】補助パラメータ（11位以降、今回は探索しない）

| パラメータ名 | 現在のデフォルト値 | 理由 |
|------------|------------------|------|
| `seed` | 42 | 再現性確保のため固定（探索不要） |
| `train_samples` | 3000 | データセットサイズ（実験条件として固定） |
| `test_samples` | 3000 | データセットサイズ（実験条件として固定） |
| `dataset` | 'mnist' | データセット種類（MNISTで固定） |
| `use_hexagonal` | True | ハニカム構造（現在最良の構造として固定） |
| `column_neurons` | None | column_radiusで自動計算（明示指定不要） |
| `leaky_alpha` | 0.01 | Leaky ReLUの負勾配（activationで探索済み） |
| `use_layer_norm` | False | 層間正規化（ED法の純粋性維持のため無効） |
| `gradient_clip` | 1.0 | 勾配クリッピング（ED法では不要） |

---

## グリッドサーチ実験設計

### Phase 1: 上位5パラメータ探索
- **探索空間**: 3^5 = 243通り
- **固定条件**: 
  - `train_samples=3000`, `test_samples=1000`
  - `epochs=30` (高速探索)
  - `seed=42` (再現性確保)
  - `layers=3` (3層構成で固定)
- **推定実行時間**: 約1.5時間（1実験あたり約20秒）

### Phase 2: 6-10位パラメータ探索
- **探索空間**: 3 × 3 × 3 × 2 × 3 = 162通り
  - `participation_rate`: 3段階
  - `hidden[0]`: 3段階
  - `hidden[1]`: 3段階
  - `activation`: 2段階
  - `epochs`: 3段階
- **固定条件**: Phase 1で得られた最良パラメータ（lr, column_radius, lateral_lr, u1, u2）を使用
- **推定実行時間**: 約1時間

### 総実行時間
- Phase 1 + Phase 2: 約2.5時間

---

## 昨夜の実験結果からの知見

### 最良設定（2025-12-12 22:17実行）
```
learning_rate=0.7, column_radius=2.0, lateral_lr=0.1
→ Test Accuracy: 32.75%
```

### 重要な発見
1. **learning_rateの影響が極めて大きい**
   - lr=0.1: 24.9%
   - lr=0.7: 32.75% (+7.85%)
   
2. **column_radiusは中程度が最適**
   - radius=1.0: 29.9%
   - radius=2.0: 32.75%
   - radius=5.0: 17.3% (大きすぎると崩壊)
   
3. **lateral_lrは高めが有効**
   - lateral_lr=0.05: 30.76%
   - lateral_lr=0.1: 32.75% (+2%)

### 今回の探索戦略
- **learning_rate**: 昨夜は0.7が最良だったが、0.6, 0.4, 0.25も試し、最適範囲を特定
- **column_radius**: 昨夜は2.0が最良。1.0-4.0の範囲で精密探索
- **lateral_lr**: 昨夜は0.1が最良。0.03-0.18の範囲で探索

---

## パラメータ間の相互作用（仮説）

### 強い相互作用が予想される組み合わせ
1. **learning_rate × column_radius**
   - 高いlrは広いcolumn_radiusと相性が良い？（昨夜の結果：lr=0.7, radius=2.0）
   
2. **u1 × lateral_lr**
   - 強いアミン拡散（高いu1）は強い側方抑制（高いlateral_lr）と相性が良い？
   
3. **participation_rate × column_radius**
   - 高い参加率（重複少）は適度なradius（2.0-3.0）と相性が良い？

### 探索時の注意点
- 極端な組み合わせ（lr=0.6 + radius=4.0など）は学習崩壊の可能性
- Phase 1で上位10-20設定を特定後、Phase 2で精密探索

---

## 期待される成果

### 目標精度
- **Phase 1完了時**: 40-50% (昨夜の32.75%から+10-15%向上)
- **Phase 2完了時**: 50-60% (構造最適化でさらに+10%向上)
- **最終目標**: 70-80% (長時間学習 + 微調整)

### 科学的価値
- ED法における各パラメータの影響度の定量化
- コラム構造と学習パラメータの相互作用の解明
- 微分の連鎖律を使わない学習法の最適設定の確立
